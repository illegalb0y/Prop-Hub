# PRD: Всплывающая мини-карточка проекта на карте

## 1. Обзор

### 1.1 Цель
Добавить всплывающую мини-карточку (popup), которая появляется при наведении курсора мыши на маркер проекта на интерактивной карте PropertyHub. Это улучшит пользовательский опыт, позволяя быстро просматривать ключевую информацию о проекте без необходимости перехода на страницу проекта.

### 1.2 Проблема
В текущей реализации пользователи могут видеть маркеры проектов на карте, но для получения базовой информации о проекте им необходимо кликнуть на маркер и перейти на страницу проекта. Это создает дополнительные шаги для пользователя и замедляет процесс ознакомления с проектами.

### 1.3 Решение
Реализовать всплывающую мини-карточку, которая будет отображаться при наведении курсора на маркер проекта и исчезать, когда курсор покидает область маркера. Карточка будет содержать ключевую информацию о проекте: название, главное изображение и минимальную цену.

## 2. Требования

### 2.1 Функциональные требования

1. **Активация и деактивация**
   - Мини-карточка должна появляться при наведении курсора на маркер проекта
   - Мини-карточка должна исчезать, когда курсор покидает область маркера
   - Анимация появления и исчезновения должна быть плавной

2. **Содержимое мини-карточки**
   - Название проекта
   - Главное изображение проекта
   - Минимальная цена с подписью "от" (price from)

3. **Поведение**
   - Мини-карточка не должна перекрывать другие важные элементы интерфейса
   - Мини-карточка должна корректно отображаться независимо от положения маркера на карте (не должна выходить за границы экрана)
   - Мини-карточка не должна мешать взаимодействию с картой и другими элементами

### 2.2 Нефункциональные требования

1. **Производительность**
   - Появление мини-карточки должно происходить без заметной задержки (не более 100мс)
   - Функционал не должен вызывать заметного снижения производительности карты даже при большом количестве маркеров

2. **Совместимость**
   - Функционал должен работать во всех современных браузерах
   - Функционал должен корректно работать на устройствах с сенсорным экраном (тап по маркеру должен вызывать появление мини-карточки)

3. **Доступность**
   - Мини-карточка должна быть доступна для пользователей с ограниченными возможностями
   - Контрастность текста должна соответствовать стандартам WCAG 2.1 AA

## 3. Дизайн и пользовательский опыт

### 3.1 Макет мини-карточки

```
+---------------------------+
|                           |
|      [Изображение]        |
|                           |
+---------------------------+
| Название проекта          |
| Цена от $XXX,XXX          |
+---------------------------+
```

### 3.2 Стилистические требования

- Дизайн мини-карточки должен соответствовать общему стилю приложения
- Использовать существующие компоненты UI библиотеки (shadcn/ui)
- Карточка должна иметь тень для визуального отделения от фона карты
- Размер карточки должен быть компактным, но достаточным для отображения всей необходимой информации

### 3.3 Поведение и анимации

- Плавное появление (fade-in) при наведении курсора
- Плавное исчезновение (fade-out) при уходе курсора
- Позиционирование карточки должно быть адаптивным, чтобы она всегда оставалась в пределах видимой области карты

## 4. Техническая реализация

### 4.1 Компоненты

- Создать новый компонент `ProjectMarkerPopup` в директории `client/src/components/`
- Интегрировать компонент в существующий компонент `full-map.tsx`

### 4.2 Технологии

- Использовать React и TypeScript для создания компонента
- Использовать Leaflet API для привязки всплывающей подсказки к маркеру
- Использовать Tailwind CSS для стилизации
- Использовать Framer Motion для анимаций (опционально)

### 4.3 Интеграция с данными

- Использовать существующие данные о проектах, которые уже загружаются для отображения маркеров
- Убедиться, что данные о цене и изображении доступны в контексте карты

## 5. Метрики успеха

- Увеличение времени, проведенного пользователями на странице карты
- Увеличение количества просмотров страниц проектов после взаимодействия с картой
- Положительные отзывы пользователей о удобстве использования карты

## 6. Тестирование

### 6.1 Функциональное тестирование

- Проверка появления/исчезновения мини-карточки при наведении/уходе курсора
- Проверка корректного отображения всех элементов мини-карточки
- Проверка корректного позиционирования мини-карточки в различных частях карты

### 6.2 Кроссбраузерное тестирование

- Chrome, Firefox, Safari, Edge
- Мобильные браузеры (iOS Safari, Android Chrome)

### 6.3 Тестирование производительности

- Проверка задержки появления мини-карточки
- Проверка влияния на общую производительность карты при большом количестве маркеров

## 7. Ограничения и риски

- Возможные проблемы с производительностью при большом количестве маркеров на карте
- Ограничения API Leaflet для реализации кастомных всплывающих подсказок
- Потенциальные проблемы с отображением на мобильных устройствах из-за отсутствия события наведения курсора

## 8. Зависимости

- Компонент `full-map.tsx`
- Библиотека Leaflet и react-leaflet
- Данные о проектах, включая изображения и цены

## 9. Критерии готовности

- Мини-карточка появляется при наведении на маркер и исчезает при уходе курсора
- Мини-карточка корректно отображает название проекта, изображение и минимальную цену
- Компонент протестирован во всех поддерживаемых браузерах
- Код соответствует стандартам проекта и прошел код-ревью